platform: linux/amd64

clone:
  git:
    image: syncloud/drone-git-amd64
    depth: 50

pipeline:
  image:
    secrets: [ARTIFACT_SSH_KEY, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY]
    image: syncloud/build-deps-amd64
    commands:
      - RELEASE="18.07"
      - echo "${board}-${installer}-base.img" > BASE_IMAGE
      - echo "syncloud-${board}-$RELEASE-${installer}.img" > IMAGE
      - ./extract-merge-upload.sh ${board} ${installer} ${arch} `cat BASE_IMAGE` `cat IMAGE`
    privileged: true

  cleanup:
    image: syncloud/build-deps-amd64
    commands:
      - ./cleanup.sh `cat BASE_IMAGE`
      - ./cleanup.sh `cat IMAGE`
    privileged: true
    when:
      status: [ failure, success ] 

     
matrix:
  include:
#    - board: raspberrypi3
#      installer: sam
#      arch: arm
#    - board: raspberrypi3
#      installer: snapd
#      arch: arm
#
#    - board: raspberrypi2
#      installer: sam
#      arch: arm
#    - board: raspberrypi2
#      installer: snapd
#      arch: arm
#
#    - board: odroid-xu3and4
#      installer: sam
#      arch: arm
#    - board: odroid-xu3and4
#      installer: snapd
#      arch: arm
#
#    - board: odroid-c2
#      installer: sam
#      arch: arm
#    - board: odroid-c2
#      installer: snapd
#      arch: arm
#
#    - board: cubieboard2
#      installer: sam
#      arch: arm
#    - board: cubieboard2
#      installer: snapd
#      arch: arm
#
#    - board: cubieboard
#      installer: sam
#      arch: arm
#    - board: cubieboard
#      installer: snapd
#      arch: arm
#
#    - board: bananapim3
#      installer: sam
#      arch: arm
#    - board: bananapim3
#      installer: snapd
#      arch: arm
#
#    - board: bananapim2
#      installer: sam
#      arch: arm
#    - board: bananapim2
#      installer: snapd
#      arch: arm
#
#    - board: beagleboneblack
#      installer: sam
#      arch: arm
#    - board: beagleboneblack
#      installer: snapd
#      arch: arm
#
#    - board: bananapim1
#      installer: sam
#      arch: arm
#    - board: bananapim1
#      installer: snapd
#      arch: arm
#
#    - board: cubietruck
#      installer: sam
#      arch: arm
#    - board: cubietruck
#      installer: snapd
#      arch: arm
#
#    - board: tinker
#      installer: sam
#      arch: arm
#    - board: tinker
#      installer: snapd
#      arch: arm
#
#    - board: helios4
#      installer: sam
#      arch: arm
#    - board: helios4
#      installer: snapd
#      arch: arm

    - board: vbox
      installer: sam
      arch: amd64
    - board: vbox
      installer: snapd
      arch: amd64
