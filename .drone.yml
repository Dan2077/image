---
kind: pipeline
name: cubieboard2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubieboard2 cubieboard2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubieboard2 syncloud-cubieboard2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubieboard2 arm syncloud-cubieboard2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubieboard2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubieboard2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: cubieboard2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubieboard2 cubieboard2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubieboard2 syncloud-cubieboard2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubieboard2 arm syncloud-cubieboard2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubieboard2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubieboard2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: cubieboard-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubieboard cubieboard-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubieboard syncloud-cubieboard-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubieboard arm syncloud-cubieboard-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubieboard-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubieboard-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: cubieboard-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubieboard cubieboard-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubieboard syncloud-cubieboard-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubieboard arm syncloud-cubieboard-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubieboard-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubieboard-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: beagleboneblack-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh beagleboneblack beagleboneblack-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh beagleboneblack syncloud-beagleboneblack-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh beagleboneblack arm syncloud-beagleboneblack-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-beagleboneblack-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-beagleboneblack-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: beagleboneblack-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh beagleboneblack beagleboneblack-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh beagleboneblack syncloud-beagleboneblack-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh beagleboneblack arm syncloud-beagleboneblack-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-beagleboneblack-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-beagleboneblack-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim3-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim3 bananapim3-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim3 syncloud-bananapim3-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim3 arm syncloud-bananapim3-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim3-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim3-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim3-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim3 bananapim3-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim3 syncloud-bananapim3-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim3 arm syncloud-bananapim3-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim3-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim3-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: rock64-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh rock64 rock64-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh rock64 syncloud-rock64-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh rock64 arm syncloud-rock64-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-rock64-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-rock64-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: rock64-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh rock64 rock64-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh rock64 syncloud-rock64-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh rock64 arm syncloud-rock64-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-rock64-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-rock64-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: helios4-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh helios4 helios4-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh helios4 syncloud-helios4-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh helios4 arm syncloud-helios4-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-helios4-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-helios4-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: helios4-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh helios4 helios4-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh helios4 syncloud-helios4-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh helios4 arm syncloud-helios4-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-helios4-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-helios4-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi3-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi3 raspberrypi3-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi3 syncloud-raspberrypi3-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi3 arm syncloud-raspberrypi3-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi3-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi3-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi3-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi3 raspberrypi3-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi3 syncloud-raspberrypi3-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi3 arm syncloud-raspberrypi3-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi3-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi3-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi4-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi4 raspberrypi4-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi4 syncloud-raspberrypi4-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi4 arm syncloud-raspberrypi4-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi4-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi4-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi4-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi4 raspberrypi4-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi4 syncloud-raspberrypi4-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi4 arm syncloud-raspberrypi4-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi4-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi4-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi2 raspberrypi2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi2 syncloud-raspberrypi2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi2 arm syncloud-raspberrypi2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: raspberrypi2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh raspberrypi2 raspberrypi2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh raspberrypi2 syncloud-raspberrypi2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh raspberrypi2 arm syncloud-raspberrypi2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-raspberrypi2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-raspberrypi2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-xu3and4-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-xu3and4 odroid-xu3and4-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-xu3and4 syncloud-odroid-xu3and4-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-xu3and4 arm syncloud-odroid-xu3and4-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-xu3and4-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-xu3and4-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-xu3and4-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-xu3and4 odroid-xu3and4-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-xu3and4 syncloud-odroid-xu3and4-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-xu3and4 arm syncloud-odroid-xu3and4-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-xu3and4-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-xu3and4-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-xu3and4-sd-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-xu3and4 odroid-xu3and4-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-xu3and4 syncloud-odroid-xu3and4-sd-buster-20.04.img 10M
  privileged: true



- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-xu3and4-sd-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-xu3and4-sd-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-xu3and4-sd-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-xu3and4 odroid-xu3and4-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-xu3and4 syncloud-odroid-xu3and4-sd-jessie-20.04.img 10M
  privileged: true



- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-xu3and4-sd-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-xu3and4-sd-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-c2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-c2 odroid-c2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-c2 syncloud-odroid-c2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-c2 arm syncloud-odroid-c2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-c2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-c2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-c2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-c2 odroid-c2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-c2 syncloud-odroid-c2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-c2 arm syncloud-odroid-c2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-c2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-c2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-u3-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-u3 odroid-u3-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-u3 syncloud-odroid-u3-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-u3 arm syncloud-odroid-u3-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-u3-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-u3-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-u3-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-u3 odroid-u3-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-u3 syncloud-odroid-u3-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-u3 arm syncloud-odroid-u3-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-u3-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-u3-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim2 bananapim2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim2 syncloud-bananapim2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim2 arm syncloud-bananapim2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim2 bananapim2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim2 syncloud-bananapim2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim2 arm syncloud-bananapim2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim1-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim1 bananapim1-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim1 syncloud-bananapim1-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim1 arm syncloud-bananapim1-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim1-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim1-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: bananapim1-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh bananapim1 bananapim1-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh bananapim1 syncloud-bananapim1-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh bananapim1 arm syncloud-bananapim1-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-bananapim1-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-bananapim1-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: cubietruck-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubietruck cubietruck-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubietruck syncloud-cubietruck-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubietruck arm syncloud-cubietruck-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubietruck-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubietruck-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: cubietruck-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh cubietruck cubietruck-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh cubietruck syncloud-cubietruck-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh cubietruck arm syncloud-cubietruck-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-cubietruck-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-cubietruck-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: tinker-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh tinker tinker-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh tinker syncloud-tinker-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh tinker arm syncloud-tinker-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-tinker-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-tinker-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: tinker-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh tinker tinker-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh tinker syncloud-tinker-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh tinker arm syncloud-tinker-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-tinker-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-tinker-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-n2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-n2 odroid-n2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-n2 syncloud-odroid-n2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-n2 arm syncloud-odroid-n2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-n2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-n2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: odroid-n2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh odroid-n2 odroid-n2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh odroid-n2 syncloud-odroid-n2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh odroid-n2 arm syncloud-odroid-n2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-odroid-n2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-odroid-n2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: lime2-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh lime2 lime2-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh lime2 syncloud-lime2-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh lime2 arm syncloud-lime2-buster-20.04.img 20.04 buster
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-lime2-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-lime2-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: lime2-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh lime2 lime2-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh lime2 syncloud-lime2-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh lime2 arm syncloud-lime2-jessie-20.04.img 20.04 jessie
  privileged: true


- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-lime2-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-lime2-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: amd64-all-buster

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh amd64 amd64-base.img buster
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh amd64 syncloud-amd64-buster-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh amd64 amd64 syncloud-amd64-buster-20.04.img 20.04 buster
  privileged: true

- name: virtualbox prepare
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: virtualbox_host
    key:
      from_secret: virtualbox_key
    source:
    - syncloud-amd64-buster-20.04.img
    - create_vbox_image.sh
    target: /data/drone-buster
    username: root

- name: virtualbox
  image: appleboy/drone-ssh
  settings:
    command_timeout: 20m
    host:
      from_secret: virtualbox_host
    key:
      from_secret: virtualbox_key
    port: 22
    script:
    - cd /data/drone-buster
    - ./create_vbox_image.sh syncloud-amd64-buster-20.04.img
    script_stop: true
    username: root
  privileged: true

- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-amd64-buster-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-amd64-buster-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

---
kind: pipeline
name: amd64-all-jessie

platform:
  os: linux
  arch: amd64

steps:
- name: extract
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/extract.sh amd64 amd64-base.img jessie
  privileged: true

- name: boot
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/boot.sh amd64 syncloud-amd64-jessie-20.04.img 3G
  privileged: true

- name: rootfs
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/rootfs.sh amd64 amd64 syncloud-amd64-jessie-20.04.img 20.04 jessie
  privileged: true

- name: virtualbox prepare
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: virtualbox_host
    key:
      from_secret: virtualbox_key
    source:
    - syncloud-amd64-jessie-20.04.img
    - create_vbox_image.sh
    target: /data/drone-jessie
    username: root

- name: virtualbox
  image: appleboy/drone-ssh
  settings:
    command_timeout: 20m
    host:
      from_secret: virtualbox_host
    key:
      from_secret: virtualbox_key
    port: 22
    script:
    - cd /data/drone-jessie
    - ./create_vbox_image.sh syncloud-amd64-jessie-20.04.img
    script_stop: true
    username: root
  privileged: true

- name: zip
  image: syncloud/build-deps-amd64
  commands:
  - ./tools/zip.sh syncloud-amd64-jessie-20.04.img
  privileged: true

- name: artifact
  image: appleboy/drone-scp
  settings:
    command_timeout: 2m
    host:
      from_secret: artifact_host
    key:
      from_secret: artifact_key
    source: syncloud-amd64-jessie-20.04.img*.xz
    target: /home/artifact/repo/image
    username: artifact

- name: cleanup
  image: syncloud/build-deps-amd64
  commands:
  - ./cleanup.sh
  privileged: true
  when:
    status:
    - failure
    - success

...
